---
title: "DA5020.P3.Group7"
author: "Thomas Faria, Sairah Shir, Caitlin Kirkpatrick"
date: "2024-08-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load required packages:

```{r, echo = FALSE}
library(tidyverse)
library(readr)
library(class) # support package for FNN (returns a class object)
library(FNN) # k-nn classification package
```

## Q1

### Data loading and exploration

```{r}

pre_taxi_data <- read_csv("2018_Green_Taxi_Trip_Data-1.csv")
problems(pre_taxi_data)

# This .csv file requires pre-processing to fix thousands separator commas that are conflicting with .csv format

# There are only a few instances of this error, so we'll simply use a text editor to fix (remove) the commas in these values

taxi_data <- read_csv("2018_Green_Taxi_Trip_Data-1_fixed.csv")
# Verify that comma errors are handled
problems(taxi_data)

```

### Feature identification

```{r}

```

### (OPTIONAL) Feature engineering

```{r}

```

## Q2

### Encode the data
```{r}
taxi_data<- dummy_cols(taxi_data, 
                   select_columns = "store_and_fwd_flag")

head(taxi_data)
```

```{r}

```

```{r}

```


### Preprocess the data 

```{r}

```

### Normalization

```{r}
# z score 

```

### Creation of training and test data sets

```{r}

# Use sample() to randomly subset
# Setting seed is required for reproducibility

set.seed(1, sample.kind = "Rejection")

index <- sample(c(1, 2),
                size = nrow(taxi_data),
                prob = c(0.75, 0.25),
                replace = T
                )

taxi_train <- taxi_data[index==1,]
head(taxi_train)

taxi_test <- taxi_data[index==2,]
head(taxi_test)

```

## Q3

### Build knn-predict() function

```{r}

# Define the knn_predict() function
# data_train and data_test should be training and test data sets supplied as df or tibble objects
# regress1, regress2 can be any continuous variables chosen for k-nn modeling (input as strings)
# Default response is tip_amount (can input as string value of another response)

knn_predict <- function (data_train, data_test, 
                         regress1, regress2, 
                         k,
                         response = "tip_amount"
                         ) {
  
  # k-nn regression with tip_amount as the default response variable
  knn_reg <- knn.reg(select(data_train, 
                            regress1,
                            regress2),
                     select(data_test, 
                            regress1,
                            regress2),
                     y = data_train[[response]], 
                     k = k
                     )
  
  # Compute MSE
  mse = mean((data_test$tip_amount - knn_reg$pred)^2)
  
  # Return MSE
  return(mse)
  
}
```

## Q4

### Obtain MSE for each k value

```{r}

loop_output <- tibble(k = numeric(), mse = double())

for (i in 1:20) {
  
  mse <- knn_predict(taxi_train, taxi_test,
                     "trip_distance", "total_amount", i
                     )
  
  loop_output <- add_row(loop_output,
                         k = i, mse = mse)
  
}

print(loop_output)
```

### Visualize k vs. MSE

```{r}



ggplot(loop_output, aes(x = k, y = mse)) +
  geom_line() +
  geom_point(color = "blue") +
  labs(title = "k value vs. MSE",
       x = "k value",
       y = "MSE") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, 
                              face = "bold", 
                              size = 14),
    axis.title.x = element_text(size = 12), 
    axis.title.y = element_text(size = 12),
    axis.text = element_text(size = 10),
    panel.grid.major = element_line(color = "grey80"), 
    panel.grid.minor = element_line(color = "grey90") 
  )
  
```

### Determine optimal k value

```{r}

```

### Discussion

## Q5

### (OPTIONAL) Visual story telling of a dataset attribute

OR

### (OPTIONAL) Optimize k-nn with training/test % split adjustments
